<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Master_Floor_Project.Converters"
        x:Class="Master_Floor_Project.Windows.ProductSelectionWindow"
        Title="Выбор продукции"
        Width="800" Height="600"
        MinWidth="750" MinHeight="550"
        MaxWidth="1000" MaxHeight="800"
        WindowStartupLocation="CenterOwner" CanResize="False"
        ShowInTaskbar="False" WindowState="Normal" SizeToContent="Manual">
    
    <Window.Resources>
        <converters:ObjectToBoolConverter x:Key="ObjectToBoolConverter"/>
        <converters:ValidationToBorderBrushConverter x:Key="ValidationToBorderBrushConverter"/>
    </Window.Resources>
    
    <Window.Styles>
        <Style Selector="TextBlock.header">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#333333"/>
        </Style>
        
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#67BA80"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>
        
        <Style Selector="Button.primary:disabled">
            <Setter Property="Background" Value="#CCCCCC"/>
            <Setter Property="Foreground" Value="#666666"/>
        </Style>
        
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#F4E8D3"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>

        <!-- Добавляем стили для DataGrid -->
        <Style Selector="DataGridColumnHeader">
            <Setter Property="Background" Value="#F4E8D3"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <Style Selector="DataGridRow">
            <Setter Property="Background" Value="#F4E8D3"/>
        </Style>
        
        <Style Selector="DataGridRow:even">
            <Setter Property="Background" Value="#F9F1E6"/>
        </Style>
        
        <Style Selector="DataGridRow:selected">
            <Setter Property="Background" Value="#67BA80"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
    </Window.Styles>

    <Border Background="#FFFFFF" Padding="20" PointerPressed="DeselectDataGrid_OnPointerPressed">
        <StackPanel Spacing="15">
            
            <!-- Заголовок -->
            <TextBlock Text="ВЫБЕРИТЕ ПРОДУКЦИЮ" 
                       Classes="header"
                       HorizontalAlignment="Center"/>
            
            <!-- Поиск -->
            <StackPanel Spacing="5">
                <TextBlock Text="Поиск:" FontWeight="SemiBold"/>
                <TextBox Text="{Binding SearchText}" 
                         Watermark="Введите название или артикул..."
                         Background="White"/>
            </StackPanel>
            
            <!-- Список продуктов -->
            <StackPanel Spacing="5">
                <TextBlock Text="Доступная продукция:" FontWeight="SemiBold"/>
                <Border BorderThickness="1" BorderBrush="#DDDDDD" Height="250">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <DataGrid x:Name="ProductsDataGrid"
                                  ItemsSource="{Binding FilteredProducts}"
                                  SelectedItem="{Binding SelectedProduct}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  Background="#F4E8D3"
                                  Height="250"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Артикул" Binding="{Binding Article}" Width="1*"/>
                                <DataGridTextColumn Header="Наименование" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="1*"/>
                                <DataGridTextColumn Header="Цена" Binding="{Binding MinPricePartner, StringFormat='{}{0:N2} руб.'}" Width="1*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </ScrollViewer>
                </Border>
            </StackPanel>
            
            <!-- Количество -->
            <StackPanel Spacing="5">
                <TextBlock Text="Количество:" FontWeight="SemiBold"/>
                <TextBox Text="{Binding QuantityInput, Mode=TwoWay}" 
                         Background="White"
                         Width="100"
                         HorizontalAlignment="Left"
                         BorderBrush="{Binding ValidationError, Converter={StaticResource ValidationToBorderBrushConverter}}"/>
                
                <!-- Отображение ошибки валидации -->
                <TextBlock Text="{Binding ValidationError}"
                           Foreground="Red"
                           FontSize="12"
                           IsVisible="{Binding ValidationError, Converter={StaticResource ObjectToBoolConverter}}"/>
            </StackPanel>
            
            <!-- Кнопки -->
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal" Spacing="15">
                <Button Content="ВЫБРАТЬ" 
                        Classes="primary"
                        Command="{Binding ConfirmCommand}"/>
                
                <Button Content="ОТМЕНА" 
                        Classes="secondary"
                        Foreground="White"
                        Command="{Binding CancelCommand}"/>
            </StackPanel>
            
        </StackPanel>
    </Border>
</Window>